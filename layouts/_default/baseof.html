<!doctype html>
<!-- 清除已有的 Scratch 变量 -->
{{ $.Scratch.Delete "bg_color" }} {{ $.Scratch.Delete "social_list" }} {{
$.Scratch.Delete "avatar_url" }}

<!-- 背景颜色映射表：定义不同主题的背景色 -->
{{ $color_map := dict "linen" "#faf8f1" "wheat" "#f8f5d7" "gray" "#fbfbfb"
"light" "#fff" }}
<!-- 设置背景颜色，如果未指定则默认使用 linen -->
{{ $.Scratch.Set "bg_color" (index $color_map (site.Params.color | default
(print "linen"))) }} {{ $bg_color := $.Scratch.Get "bg_color" }}

<!-- 定义支持的社交媒体平台列表 -->
{{ $social_params := slice "twitter" "github" "instagram" "linkedin" "mastodon"
"threads" "bluesky" "rss" }}
<!-- 遍历社交媒体平台，将已配置的平台添加到列表中 -->
{{ range $social_params }} {{ if isset site.Params . }} {{ $.Scratch.Add
"social_list" (slice .) }} {{ end }} {{ end }}

<!-- 处理头像 URL -->
{{ if site.Params.avatar }}
<!-- 如果是 http 链接，直接使用 -->
{{ if in site.Params.avatar "http" }} {{ $.Scratch.Set "avatar_url"
site.Params.avatar }}
<!-- 否则使用 Gravatar -->
{{ else }} {{ $official_cdn := "https://www.gravatar.com/avatar/" }} {{ $cdn :=
(site.Params.gravatarCdn | default $official_cdn) }} {{ $md5 := (md5
site.Params.avatar) }} {{ $avatar_url := print $cdn $md5 "?s=160&d=identicon" }}
{{ $.Scratch.Set "avatar_url" $avatar_url }} {{ end }} {{ end }}

<html
    class="not-ready lg:text-base"
    style="--bg: {{ $bg_color }}"
    lang="{{ or site.LanguageCode site.Language.Lang }}"
    dir="{{ if site.Params.direction }}{{ site.Params.direction }}{{ else }}ltr{{ end }}"
>
    <!-- 引入头部模板，包含 meta 标签和样式表 -->
    {{ partial "head.html" . }}

    <!-- 页面主体 -->
    <body class="text-black duration-200 ease-out dark:text-white">
        <!-- 引入头部导航栏模板 -->
        {{ partial "header.html" . }}

        <!-- 主要内容区域：使用 flex 布局实现主内容和侧边栏的排列 -->
        <div class="flex relative max-w-[--w] mx-auto">
            <!-- 主内容区域 -->
            <main
                class="prose prose-neutral relative min-h-[calc(100vh-9rem)] px-8 pb-16 pt-14 dark:prose-invert flex-grow"
            >
                <!-- 内容块，将被各个页面模板填充 -->
                {{ block "main" . }}{{ end }}
            </main>
            <!-- 侧边栏：引入 sidebar 模板 -->
            <aside class="">{{ partial "sidebar.html" . }}</aside>
        </div>

        <!-- 引入页脚模板 -->
        {{ partial "footer.html" . }}
    </body>
</html>
