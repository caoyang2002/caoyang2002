<!doctype html><html class="not-ready lg:text-base close" style=--bg:#faf8f1 lang=zh-CN dir=ltr><style>body{background-image:url(/images/ui/background.jpg);background-repeat:no-repeat;background-position:50%;background-attachment:fixed;background-size:cover;min-height:100vh}html,body{min-height:100vh}</style><script id=LA_COLLECT src=//sdk.51.la/js-sdk-pro.min.js></script><script src=https://cdn.tailwindcss.com></script><script>LA.init({id:"3L3XAvCJS5maI7j0",ck:"3L3XAvCJS5maI7j0"})</script><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>é›¶å¤åˆ¶æŠ€æœ¯ - çŸ­æ¾æ±Ÿæœˆ</title><meta name=theme-color><meta name=description content="

   æŸ¥çœ‹åŸæ–‡
   
     â†—
   


é›¶å¤åˆ¶(zero copy)æŠ€æœ¯
1.1 èƒŒæ™¯è¯´æ˜ï¼šç½‘ç»œæ•°æ®ä¼ è¾“çš„å…¨è¿‡ç¨‹
åœ¨æ¯ä¸€æ¬¡ç½‘ç»œioè¿‡ç¨‹ï¼Œæ•°æ®éƒ½è¦ç»è¿‡å‡ ä¸ªç¼“å­˜ï¼Œå†å‘é€å‡ºå»ã€‚å¦‚ä¸‹å›¾ï¼š

ä»¥å³ä¾§ä¸ºæµè§ˆå™¨ï¼Œå·¦ä¾§ä¸ºhttpdæœåŠ¡å™¨ä¸ºä¾‹ã€‚


å½“httpdæœåŠ¡æ”¶åˆ°æµè§ˆå™¨å‘é€çš„index.htmlæ–‡ä»¶çš„è¯·æ±‚æ—¶ï¼Œè´Ÿè´£å¤„ç†è¯·æ±‚çš„httpdå­è¿›ç¨‹/çº¿ç¨‹æ€»æ˜¯ä¼šå…ˆå‘èµ·ç³»ç»Ÿè°ƒç”¨ï¼Œè®©å†…æ ¸å°†index.htmlä»å­˜å‚¨è®¾å¤‡ä¸­åŠ è½½å‡ºæ¥ã€‚ä½†æ˜¯åŠ è½½åˆ°çš„ä½ç½®æ˜¯å†…æ ¸ç©ºé—´çš„ç¼“å†²åŒºkernel bufferï¼Œè€Œä¸æ˜¯ç›´æ¥ç»™è¿›ç¨‹/çº¿ç¨‹çš„å†…å­˜åŒºã€‚ç”±äºæ˜¯å†…å­˜è®¾å¤‡å’Œå­˜å‚¨è®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œæ²¡æœ‰CPUçš„å‚ä¸ï¼Œæ‰€ä»¥è¿™æ¬¡æ˜¯DMAæ“ä½œã€‚"><meta name=author content="simons"><script src=/js/code-copy.js defer></script><link rel="preload stylesheet" as=style href=/bundle.min.f3bc111e72b76d0ea1f98d1d8e9a0e3831300bce7ffa176166282c0ac4af2830.css><link rel=preload as=image href=/theme.png><link rel=preload as=image href=/about/avatar.jpg><link rel=preload as=image href=/twitter.svg><link rel=preload as=image href=/github.svg><link rel=preload as=image href=/instagram.svg><link rel=preload as=image href=/rss.svg><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/monokai.min.css><script defer src=https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js></script><script defer src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js onload=hljs.highlightAll()></script><script defer src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/lisp.min.js></script><script defer src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/sql.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css integrity=sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js integrity=sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",()=>renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1}))</script><link rel=icon href=/favicon.ico><link rel=apple-touch-icon href=/apple-touch-icon.png><meta name=generator content="Hugo 0.155.0"><meta itemprop=name content="é›¶å¤åˆ¶æŠ€æœ¯"><meta itemprop=description content="æœ¬æ–‡æ·±å…¥è§£æé›¶å¤åˆ¶(zero-copy)æŠ€æœ¯åŸç†ï¼Œè¯¦ç»†å¯¹æ¯”mmapã€sendfileã€spliceç­‰ç³»ç»Ÿè°ƒç”¨çš„å·¥ä½œæµç¨‹ä¸é€‚ç”¨åœºæ™¯ï¼Œé€šè¿‡å›¾è§£å’Œä»£ç ç¤ºä¾‹è¯´æ˜å¦‚ä½•å‡å°‘æ•°æ®åœ¨å†…æ ¸ä¸ç”¨æˆ·ç©ºé—´ä¹‹é—´çš„å†—ä½™æ‹·è´ï¼Œå¤§å¹…æå‡ç½‘ç»œä¼ è¾“å’Œæ–‡ä»¶æ“ä½œæ€§èƒ½ã€‚"><meta itemprop=datePublished content="2026-01-26T13:45:11+08:00"><meta itemprop=dateModified content="2026-01-29T11:32:58+08:00"><meta itemprop=wordCount content="3231"><meta itemprop=keywords content="é›¶å¤åˆ¶,ç³»ç»Ÿè°ƒç”¨,Mmap,Sendfile,Splice,DMA,å†…æ ¸ç©ºé—´,ç½‘ç»œä¼ è¾“,æ€§èƒ½è°ƒä¼˜"><meta property="og:url" content="https://simons.qzz.io/post/2026/01/zero_copy/"><meta property="og:site_name" content="çŸ­æ¾æ±Ÿæœˆ"><meta property="og:title" content="é›¶å¤åˆ¶æŠ€æœ¯"><meta property="og:description" content="æœ¬æ–‡æ·±å…¥è§£æé›¶å¤åˆ¶(zero-copy)æŠ€æœ¯åŸç†ï¼Œè¯¦ç»†å¯¹æ¯”mmapã€sendfileã€spliceç­‰ç³»ç»Ÿè°ƒç”¨çš„å·¥ä½œæµç¨‹ä¸é€‚ç”¨åœºæ™¯ï¼Œé€šè¿‡å›¾è§£å’Œä»£ç ç¤ºä¾‹è¯´æ˜å¦‚ä½•å‡å°‘æ•°æ®åœ¨å†…æ ¸ä¸ç”¨æˆ·ç©ºé—´ä¹‹é—´çš„å†—ä½™æ‹·è´ï¼Œå¤§å¹…æå‡ç½‘ç»œä¼ è¾“å’Œæ–‡ä»¶æ“ä½œæ€§èƒ½ã€‚"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-01-26T13:45:11+08:00"><meta property="article:modified_time" content="2026-01-29T11:32:58+08:00"><meta property="article:tag" content="é›¶å¤åˆ¶"><meta property="article:tag" content="ç³»ç»Ÿè°ƒç”¨"><meta property="article:tag" content="Mmap"><meta property="article:tag" content="Sendfile"><meta property="article:tag" content="Splice"><meta property="article:tag" content="DMA"><meta name=twitter:card content="summary"><meta name=twitter:title content="é›¶å¤åˆ¶æŠ€æœ¯"><meta name=twitter:description content="æœ¬æ–‡æ·±å…¥è§£æé›¶å¤åˆ¶(zero-copy)æŠ€æœ¯åŸç†ï¼Œè¯¦ç»†å¯¹æ¯”mmapã€sendfileã€spliceç­‰ç³»ç»Ÿè°ƒç”¨çš„å·¥ä½œæµç¨‹ä¸é€‚ç”¨åœºæ™¯ï¼Œé€šè¿‡å›¾è§£å’Œä»£ç ç¤ºä¾‹è¯´æ˜å¦‚ä½•å‡å°‘æ•°æ®åœ¨å†…æ ¸ä¸ç”¨æˆ·ç©ºé—´ä¹‹é—´çš„å†—ä½™æ‹·è´ï¼Œå¤§å¹…æå‡ç½‘ç»œä¼ è¾“å’Œæ–‡ä»¶æ“ä½œæ€§èƒ½ã€‚"><link rel=canonical href=https://simons.qzz.io/post/2026/01/zero_copy/></head><body class="text-black duration-200 ease-out dark:text-white"><header class="mx-auto flex h-12 px-8 lg:justify-center"><div class="relative z-50 ltr:mr-auto rtl:ml-auto flex items-center max-w-[--w]"><a class="-translate-y-[1px] text-2xl font-medium" href=https://simons.qzz.io/>çŸ­æ¾æ±Ÿæœˆ</a><div class="btn-dark text-[0] ltr:ml-4 rtl:mr-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]" role=button aria-label=Dark></div></div><div class="btn-menu relative z-50 ltr:-mr-8 rtl:-ml-8 flex h-[3rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden" role=button aria-label=Menu></div><script>const htmlClass=document.documentElement.classList;setTimeout(()=>{htmlClass.remove("not-ready")},10);const btnMenu=document.querySelector(".btn-menu");btnMenu.addEventListener("click",()=>{htmlClass.contains("open")?(htmlClass.remove("open"),htmlClass.add("close")):(htmlClass.remove("close"),htmlClass.add("open"))});const metaTheme=document.querySelector('meta[name="theme-color"]'),lightBg="#faf8f1".replace(/"/g,""),setDark=e=>{metaTheme.setAttribute("content",e?"#000":lightBg),htmlClass[e?"add":"remove"]("dark"),localStorage.setItem("dark",e)},darkScheme=window.matchMedia("(prefers-color-scheme: dark)");if(htmlClass.contains("dark"))setDark(!0);else{const e=localStorage.getItem("dark");setDark(e?e==="true":darkScheme.matches)}darkScheme.addEventListener("change",e=>{setDark(e.matches)});const btnDark=document.querySelector(".btn-dark");btnDark.addEventListener("click",()=>{setDark(localStorage.getItem("dark")!=="true")})</script><div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"><nav class="lg:ml-0 lg:flex lg:flex-row lg:items-center lg:space-x-10 rtl:space-x-reverse"><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal header-menu" href=/>é¦–é¡µ
</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal header-menu" href=/rocket/>ç«ç®­
</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal header-menu" href=/protfolio/>ä½œå“é›†
</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal header-menu" href=/about/>å…³äº
</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal header-menu" href=/contact/>è”ç³»
</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal header-menu" href=/guestbook/>ç•™è¨€
</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal header-menu" href=/resources/>èµ„æº
</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal header-menu" href=/booklist/>ä¹¦å•
</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal header-menu" href=/hotlist/>çƒ­æœ
</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal header-menu" href=/search/>æœç´¢</a><div class=language-selector><div class="inline-block text-left dropdown"><div><p class=selected-language>Chinese</p></div><div style=background-color:red;z-index:1000></div></div><script>const dropdownButton=document.getElementById("dropdownButton"),dropdownMenu=document.getElementById("dropdownMenu"),dropdownIcon=document.querySelector(".dropdown-icon");dropdownButton.addEventListener("click",function(){dropdownMenu.classList.toggle("show"),dropdownButton.parentElement.classList.toggle("open")}),dropdownMenu.querySelectorAll("li").forEach(e=>{e.addEventListener("click",function(){dropdownButton.textContent=e.textContent+" ",dropdownButton.appendChild(dropdownIcon),dropdownMenu.classList.remove("show"),dropdownButton.parentElement.classList.remove("open");const t=e.getAttribute("data-value");console.log("Selected Language:",t)})}),document.addEventListener("click",function(e){!dropdownButton.contains(e.target)&&!dropdownMenu.contains(e.target)&&(dropdownMenu.classList.remove("show"),dropdownButton.parentElement.classList.remove("open"))})</script><style>.dropdown{display:inline-block;margin:0}.dropdown-menu{background-color:#fff;border:1px solid #ddd;border-radius:8px;padding:0;margin:0;display:none}.dropdown-menu.show{display:block}.dropdown-menu li{padding:.2rem;cursor:pointer;color:#333}.dropdown-menu>li:hover{background-color:initial}.selected-language:hover{color:#0042da}</style></div></nav></div></header><style>.language-selector{position:relative;display:inline-block;z-index:10}.language-selector .dropdown-menu{display:none;position:absolute;top:100%;right:0;background-color:#fff;border:1px solid #ddd;border-radius:4px;box-shadow:0 4px 8px rgba(0,0,0,.1);z-index:50}.language-selector:hover .dropdown-menu{display:block}.header-menu:hover{color:#0042da}header{position:fixed;top:0;left:0;right:0;z-index:50;width:100vw;text-align:center;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);background:rgba(255,255,255,.5);box-shadow:0 4px 30px rgba(0,0,0,.1)}.header-menu:hover{color:#0042da}</style><div class="relative flex justify-start max-w-[90vw] px-8"><main class="min-h-[calc(100vh-5rem)] py-12 prose prose-neutral flex-1 dark:prose-invert text-left max-w-full lg:max-w-4xl xl:max-w-6xl"><article class=text-left><div class="mb-14 mt-8"><h1 class="!my-0 pb-2.5">é›¶å¤åˆ¶æŠ€æœ¯</h1><div class="text-xs antialiased opacity-60"><time>2026å¹´1æœˆ26æ—¥æ˜ŸæœŸä¸€
</time><span class=mx-1>&#183;</span>
<span>simons
</span><span class=mx-1>&#183;</span>
<span class=post-date>æœ¬æ–‡å…± 3231
ä¸ªå­— ï¼Œ é¢„è®¡éœ€è¦é˜…è¯» 7
åˆ†é’Ÿ</span></div><span class="text-md antialiased opacity-60"><a href=https://simons.qzz.io/tags/%E9%9B%B6%E5%A4%8D%E5%88%B6 class="mb-2 ltr:mr-1.5 rtl:ml-1.5 px-3 py-1 rounded-lg no-underline bg-black/[3%] hover:bg-black/[6%] dark:bg-white/[8%] dark:hover:bg-white/[12%]">é›¶å¤åˆ¶
</a><a href=https://simons.qzz.io/tags/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8 class="mb-2 ltr:mr-1.5 rtl:ml-1.5 px-3 py-1 rounded-lg no-underline bg-black/[3%] hover:bg-black/[6%] dark:bg-white/[8%] dark:hover:bg-white/[12%]">ç³»ç»Ÿè°ƒç”¨
</a><a href=https://simons.qzz.io/tags/mmap class="mb-2 ltr:mr-1.5 rtl:ml-1.5 px-3 py-1 rounded-lg no-underline bg-black/[3%] hover:bg-black/[6%] dark:bg-white/[8%] dark:hover:bg-white/[12%]">mmap
</a><a href=https://simons.qzz.io/tags/sendfile class="mb-2 ltr:mr-1.5 rtl:ml-1.5 px-3 py-1 rounded-lg no-underline bg-black/[3%] hover:bg-black/[6%] dark:bg-white/[8%] dark:hover:bg-white/[12%]">sendfile
</a><a href=https://simons.qzz.io/tags/splice class="mb-2 ltr:mr-1.5 rtl:ml-1.5 px-3 py-1 rounded-lg no-underline bg-black/[3%] hover:bg-black/[6%] dark:bg-white/[8%] dark:hover:bg-white/[12%]">splice
</a><a href=https://simons.qzz.io/tags/dma class="mb-2 ltr:mr-1.5 rtl:ml-1.5 px-3 py-1 rounded-lg no-underline bg-black/[3%] hover:bg-black/[6%] dark:bg-white/[8%] dark:hover:bg-white/[12%]">DMA
</a><a href=https://simons.qzz.io/tags/%E5%86%85%E6%A0%B8%E7%A9%BA%E9%97%B4 class="mb-2 ltr:mr-1.5 rtl:ml-1.5 px-3 py-1 rounded-lg no-underline bg-black/[3%] hover:bg-black/[6%] dark:bg-white/[8%] dark:hover:bg-white/[12%]">å†…æ ¸ç©ºé—´
</a><a href=https://simons.qzz.io/tags/%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93 class="mb-2 ltr:mr-1.5 rtl:ml-1.5 px-3 py-1 rounded-lg no-underline bg-black/[3%] hover:bg-black/[6%] dark:bg-white/[8%] dark:hover:bg-white/[12%]">ç½‘ç»œä¼ è¾“
</a><a href=https://simons.qzz.io/tags/%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98 class="mb-2 ltr:mr-1.5 rtl:ml-1.5 px-3 py-1 rounded-lg no-underline bg-black/[3%] hover:bg-black/[6%] dark:bg-white/[8%] dark:hover:bg-white/[12%]">æ€§èƒ½è°ƒä¼˜</a></span></div><section><p><a href=https://www.cnblogs.com/f-ck-need-u/p/7615914.html target=_blank rel="noopener noreferrer" class=external-link>æŸ¥çœ‹åŸæ–‡
<span class=external-icon>â†—</span></a></p><h1 id=é›¶å¤åˆ¶zero-copyæŠ€æœ¯>é›¶å¤åˆ¶(zero copy)æŠ€æœ¯</h1><h2 id=11-èƒŒæ™¯è¯´æ˜ç½‘ç»œæ•°æ®ä¼ è¾“çš„å…¨è¿‡ç¨‹>1.1 èƒŒæ™¯è¯´æ˜ï¼šç½‘ç»œæ•°æ®ä¼ è¾“çš„å…¨è¿‡ç¨‹</h2><p>åœ¨æ¯ä¸€æ¬¡ç½‘ç»œioè¿‡ç¨‹ï¼Œæ•°æ®éƒ½è¦ç»è¿‡å‡ ä¸ªç¼“å­˜ï¼Œå†å‘é€å‡ºå»ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src=https://images2017.cnblogs.com/blog/733013/201709/733013-20170930140554637-512964522.png alt="I/O between OSs" title="I/O between OSs"></p><p>ä»¥å³ä¾§ä¸ºæµè§ˆå™¨ï¼Œå·¦ä¾§ä¸ºhttpdæœåŠ¡å™¨ä¸ºä¾‹ã€‚</p><ol><li><p>å½“httpdæœåŠ¡æ”¶åˆ°æµè§ˆå™¨å‘é€çš„index.htmlæ–‡ä»¶çš„è¯·æ±‚æ—¶ï¼Œè´Ÿè´£å¤„ç†è¯·æ±‚çš„httpdå­è¿›ç¨‹/çº¿ç¨‹æ€»æ˜¯ä¼šå…ˆå‘èµ·ç³»ç»Ÿè°ƒç”¨ï¼Œè®©å†…æ ¸å°†index.htmlä»å­˜å‚¨è®¾å¤‡ä¸­åŠ è½½å‡ºæ¥ã€‚ä½†æ˜¯åŠ è½½åˆ°çš„ä½ç½®æ˜¯å†…æ ¸ç©ºé—´çš„ç¼“å†²åŒºkernel bufferï¼Œè€Œä¸æ˜¯ç›´æ¥ç»™è¿›ç¨‹/çº¿ç¨‹çš„å†…å­˜åŒºã€‚ç”±äºæ˜¯å†…å­˜è®¾å¤‡å’Œå­˜å‚¨è®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œæ²¡æœ‰CPUçš„å‚ä¸ï¼Œæ‰€ä»¥è¿™æ¬¡æ˜¯DMAæ“ä½œã€‚</p></li><li><p>å½“æ•°æ®å‡†å¤‡å¥½åï¼Œå†…æ ¸å”¤é†’httpdå­è¿›ç¨‹/çº¿ç¨‹ï¼Œè®©å®ƒä½¿ç”¨read()å‡½æ•°æŠŠæ•°æ®å¤åˆ¶åˆ°å®ƒè‡ªå·±çš„ç¼“å†²åŒºï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„app bufferã€‚åˆ°äº†app bufferä¸­çš„æ•°æ®ï¼Œå·²ç»ç‹¬å±äºè¿›ç¨‹/çº¿ç¨‹ï¼Œä¹Ÿå°±å¯ä»¥å¯¹å®ƒåšè¯»å–ã€ä¿®æ”¹ç­‰ç­‰æ“ä½œã€‚ç”±äºè¿™æ¬¡æ˜¯ä½¿ç”¨CPUæ¥å¤åˆ¶çš„ï¼Œæ‰€ä»¥ä¼šæ¶ˆè€—CPUèµ„æºã€‚ç”±äºè¿™ä¸ªé˜¶æ®µä»å†…æ ¸ç©ºé—´åˆ‡æ¢åˆ°ç”¨æˆ·ç©ºé—´ï¼Œæ‰€ä»¥è¿›è¡Œäº†ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p></li><li><p>å½“æ•°æ®ä¿®æ”¹å®Œæˆ(ä¹Ÿå¯èƒ½æ²¡åšä»»ä½•æ“ä½œ)åï¼ŒæŒ‰æˆ‘ä»¬æ‰€æƒ³çš„ï¼Œéœ€è¦æŠŠå®ƒå“åº”ç»™æµè§ˆå™¨ï¼Œä¹Ÿå°±æ˜¯è¯´è¦é€šè¿‡TCPè¿æ¥ä¼ è¾“å‡ºå»ã€‚ä½†TCPåè®®æ ˆæœ‰è‡ªå·±çš„ç¼“å†²åŒºï¼Œè¦é€šè¿‡å®ƒå‘é€æ•°æ®ï¼Œå¿…é¡»å°†æ•°æ®å†™åˆ°å®ƒçš„bufferä¸­ï¼Œå¯¹äºå‘é€è€…å°±æ˜¯send bufferï¼Œå¯¹äºæ¥å—è€…å°±æ˜¯recv bufferã€‚äºæ˜¯ï¼Œé€šè¿‡write()å‡½æ•°å°†æ•°æ®å†æ¬¡ä»app bufferå¤åˆ¶åˆ°send bufferã€‚è¿™æ¬¡ä¹Ÿæ˜¯CPUå‚ä¸è¿›è¡Œçš„å¤åˆ¶ï¼Œæ‰€ä»¥ä¼šæ¶ˆè€—CPUã€‚åŒæ ·ä¹Ÿä¼šè¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p></li><li><p>éæœ¬æœºæ•°æ®æœ€ç»ˆè¿˜æ˜¯ä¼šé€šè¿‡ç½‘å¡ä¼ è¾“å‡ºå»çš„ï¼Œæ‰€ä»¥å†ä½¿ç”¨send()å‡½æ•°å°±å¯ä»¥å°†send bufferä¸­çš„æ•°æ®äº¤ç»™ç½‘å¡å¹¶é€šè¿‡ç½‘å¡ä¼ è¾“å‡ºå»ã€‚ç”±äºè¿™æ¬¡æ˜¯å†…å­˜å’Œè®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œæ²¡æœ‰CPUçš„å‚ä¸ï¼Œæ‰€ä»¥è¿™æ¬¡ä¹Ÿæ˜¯DMAæ“ä½œã€‚</p></li><li><p>å½“æµè§ˆå™¨æ‰€åœ¨ä¸»æœºçš„ç½‘å¡æ”¶åˆ°å“åº”æ•°æ®å(å½“ç„¶ï¼Œæ•°æ®æ˜¯æºæºä¸æ–­ä¼ è¾“çš„)ï¼Œå°†å®ƒä¼ è¾“åˆ°TCPçš„recv bufferã€‚è¿™æ¬¡æ˜¯DMAæ“ä½œã€‚</p></li><li><p>æ•°æ®æºæºä¸æ–­åœ°å¡«å……åˆ°recv bufferä¸­ï¼Œä½†æ˜¯æµè§ˆå™¨å´ä¸ä¸€å®šä¼šå»è¯»å–ï¼Œè€Œæ˜¯éœ€è¦é€šçŸ¥æµè§ˆå™¨è¿›ç¨‹ä½¿ç”¨recv()å‡½æ•°å°†æ•°æ®ä»read bufferä¸­å–èµ°ã€‚è¿™æ¬¡æ˜¯CPUæ“ä½œ(å›¾ä¸­å¿˜è®°æ ‡æ³¨äº†)ã€‚</p></li></ol><p>éœ€è¦æ³¨æ„ï¼Œå¯¹äºhttpdç«¯æ¥è¯´ï¼Œå¦‚æœç½‘é€Ÿå¾ˆæ…¢ï¼Œè€Œhttpdå­è¿›ç¨‹/çº¿ç¨‹éœ€è¦å“åº”å‡ºå»çš„æ•°æ®åˆè¶³å¤Ÿå¤§(æ¯”send bufferè¿˜å¤§)ï¼Œå¾ˆå¯èƒ½ä¼šå¯¼è‡´socket bufferå¡«æ»¡çš„æƒ…å†µï¼Œè¿™æ—¶write()å‡½æ•°ä¼šè¿”å›EWOULDBLOCKæˆ–EAGAINï¼Œå­è¿›ç¨‹/çº¿ç¨‹ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚</p><p>å¯¹äºæµè§ˆå™¨ä¸€ç«¯æ¥è¯´ï¼Œå¦‚æœæµè§ˆå™¨è¿›ç¨‹è¿Ÿè¿Ÿä¸å°†æ•°æ®ä»socket buffer(recv buffer)ä¸­å–èµ°ï¼Œå¾ˆå¯èƒ½ä¼šå¯¼è‡´socket bufferè¢«å¡«æ»¡ã€‚</p><p>å†æ¥è¯´httpdç«¯ç½‘ç»œæ•°æ®çš„"ç»å†"ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src=https://images2017.cnblogs.com/blog/733013/201709/733013-20170930140728294-843483.png alt="I/O in single OS" title="I/O in single OS"></p><p>æ¯æ¬¡è¿›ç¨‹/çº¿ç¨‹éœ€è¦ä¸€æ®µæ•°æ®æ—¶ï¼Œæ€»æ˜¯å…ˆæ‹·è´åˆ°kernel bufferï¼Œå†æ‹·è´åˆ°app bufferï¼Œå†æ‹·è´åˆ°socket bufferï¼Œæœ€åå†æ‹·è´åˆ°ç½‘å¡ä¸Šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ€»æ˜¯ä¼šç»è¿‡4æ®µæ‹·è´ç»å†ã€‚</p><p>ä½†æƒ³æƒ³ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œæ•°æ®ä»å­˜å‚¨è®¾å¤‡åˆ°kernel bufferæ˜¯å¿…é¡»çš„ï¼Œä»socket bufferåˆ°NICä¹Ÿæ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯ä»kernel bufferåˆ°app bufferæ˜¯å¿…é¡»çš„å—ï¼Ÿè¿›ç¨‹ä¸€å®šéœ€è¦è®¿é—®ã€ä¿®æ”¹è¿™äº›æ•°æ®å—ï¼Ÿä¸ä¸€å®šï¼Œç”šè‡³å¯¹äºwebæœåŠ¡æ¥è¯´ï¼Œå¦‚æœä¸æ˜¯è¦ä¿®æ”¹httpå“åº”æŠ¥æ–‡ï¼Œæ•°æ®å®Œå…¨å¯ä»¥ä¸ç”¨ç»è¿‡ç”¨æˆ·ç©ºé—´ã€‚ä¹Ÿå°±æ˜¯ä¸ç”¨å†ä»kernel bufferæ‹·è´åˆ°app bufferï¼Œè¿™å°±æ˜¯é›¶å¤åˆ¶çš„æ¦‚å¿µã€‚</p><p>é›¶å¤åˆ¶çš„æ¦‚å¿µæ˜¯é¿å…å°†æ•°æ®åœ¨å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´è¿›è¡Œæ‹·è´ã€‚ä¸»è¦ç›®çš„æ˜¯å‡å°‘ä¸å¿…è¦çš„æ‹·è´ï¼Œé¿å…è®©CPUåšå¤§é‡çš„æ•°æ®æ‹·è´ä»»åŠ¡ã€‚</p><p>æ³¨ï¼šä¸Šé¢åªæ˜¯è¯´æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¾‹å¦‚æŸäº›ç¡¬ä»¶å¯ä»¥å®ŒæˆTCP/IPåè®®æ ˆçš„å·¥ä½œï¼Œæ•°æ®å¯ä»¥ä¸ç»è¿‡socket bufferï¼Œç›´æ¥åœ¨app bufferå’Œç¡¬ä»¶ä¹‹é—´ä¼ è¾“æ•°æ®ï¼ŒRDMAæŠ€æœ¯å°±æ˜¯åœ¨æ­¤åŸºç¡€ä¸Šå®ç°çš„ã€‚</p><h2 id=12-zero-copymmap>1.2 zero-copy:mmap()</h2><p>mmap()å‡½æ•°å°†æ–‡ä»¶ç›´æ¥æ˜ å°„åˆ°ç”¨æˆ·ç¨‹åºçš„å†…å­˜ä¸­ï¼Œæ˜ å°„æˆåŠŸæ—¶è¿”å›æŒ‡å‘ç›®æ ‡åŒºåŸŸçš„æŒ‡é’ˆã€‚è¿™æ®µå†…å­˜ç©ºé—´å¯ä»¥ç”¨ä½œè¿›ç¨‹é—´çš„å…±äº«å†…å­˜ç©ºé—´ï¼Œå†…æ ¸ä¹Ÿå¯ä»¥ç›´æ¥æ“ä½œè¿™æ®µç©ºé—´ã€‚</p><p>åœ¨æ˜ å°„æ–‡ä»¶ä¹‹åï¼Œæš‚æ—¶ä¸ä¼šæ‹·è´ä»»ä½•æ•°æ®åˆ°å†…å­˜ä¸­ï¼Œåªæœ‰å½“è®¿é—®è¿™æ®µå†…å­˜æ—¶ï¼Œå‘ç°æ²¡æœ‰æ•°æ®ï¼Œäºæ˜¯äº§ç”Ÿç¼ºé¡µè®¿é—®ï¼Œä½¿ç”¨DMAæ“ä½œå°†æ•°æ®æ‹·è´åˆ°è¿™æ®µç©ºé—´ä¸­ã€‚å¯ä»¥ç›´æ¥å°†è¿™æ®µç©ºé—´çš„æ•°æ®æ‹·è´åˆ°socket bufferä¸­ã€‚æ‰€ä»¥ä¹Ÿç®—æ˜¯é›¶å¤åˆ¶æŠ€æœ¯ã€‚å¦‚å›¾ï¼š</p><p><img src=https://images2017.cnblogs.com/blog/733013/201710/733013-20171001160402340-1597578521.png alt></p><p>ä»£ç å¦‚ä¸‹ï¼š</p><div><pre><code class=language- data-lang>1
2
3</code></pre></div><h2 id=13-zero-copysendfile>1.3 zero-copy:sendfile()</h2><p>manæ–‡æ¡£å¯¹æ­¤å‡½æ•°çš„æè¿°ï¼š</p><p>sendfile() copies data between one file descriptor and another. Because this copying is done within the kernel,
sendfile() is more efficient than the combination of read(2) and write(2), which would require transferring data to and from user space.</p><p>sendfile()å‡½æ•°å€ŸåŠ©æ–‡ä»¶æè¿°ç¬¦æ¥å®ç°æ•°æ®æ‹·è´ï¼šç›´æ¥å°†æ–‡ä»¶æè¿°in_fdçš„æ•°æ®æ‹·è´ç»™æ–‡ä»¶æè¿°ç¬¦out_fdï¼Œå…¶ä¸­in_fdæ˜¯æ•°æ®æä¾›æ–¹ï¼Œout_fdæ˜¯æ•°æ®æ¥æ”¶æ–¹ã€‚æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œéƒ½æ˜¯åœ¨å†…æ ¸è¿›è¡Œçš„ï¼Œä¸ä¼šç»è¿‡ç”¨æˆ·ç©ºé—´ï¼Œæ‰€ä»¥æ•°æ®ä¸ç”¨æ‹·è´åˆ°app bufferï¼Œå®ç°äº†é›¶å¤åˆ¶ã€‚å¦‚ä¸‹å›¾</p><p><img src=https://images2017.cnblogs.com/blog/733013/201709/733013-20170930141043731-2003336331.png alt="zero copy: sendfile" title="zero copy: sendfile"></p><p>sendfile()çš„ä»£ç å¦‚ä¸‹ï¼š</p><div><pre><code class=language- data-lang>1
2</code></pre></div><p>ä½†æ˜¯sendfileçš„in_fdå¿…é¡»æŒ‡å‘æ”¯æŒmmapçš„æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯çœŸå®å­˜åœ¨çš„æ–‡ä»¶ï¼Œè€Œä¸èƒ½æ˜¯socketã€ç®¡é“ç­‰æ–‡ä»¶ã€‚åœ¨Linux 2.6.33ä¹‹å‰ï¼Œè¿˜é™åˆ¶out_fdå¿…é¡»æ˜¯æŒ‡å‘socketæ–‡ä»¶çš„æè¿°ç¬¦ï¼Œæ‰€ä»¥äººä»¬æ€»è®¤ä¸ºå®ƒä¸“é—¨ç”¨äºè¿›è¡Œç½‘ç»œæ•°æ®æ‹·è´ã€‚ä½†ä»Linux 2.6.33å¼€å§‹ï¼Œout_fdå¯ä»¥æ˜¯ä»»ä½•æ–‡ä»¶ï¼Œä¸”å¦‚æœæ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼Œåˆ™sendfile()ä¼šåˆç†åœ°ä¿®æ”¹æ–‡ä»¶çš„offsetã€‚</p><p>ä»¥nginxå¼€å¯äº†<strong>tcp_nopush</strong>çš„sendfileä¸ºä¾‹ï¼Œå½“å¼€å¯äº†tcp_nopushåŠŸèƒ½åï¼Œ<strong>nginxå…ˆåœ¨ç”¨æˆ·ç©ºé—´æ„å»ºå“åº”é¦–éƒ¨ï¼Œå¹¶æ”¾è¿›socket send bufferä¸­ï¼Œç„¶åå†å‘sender bufferä¸­å†™å…¥ä¸€ä¸ªå¾…åŠ è½½æ–‡ä»¶çš„æ ‡è¯†</strong>(ä¾‹å¦‚ï¼Œå£°æ˜æˆ‘ç¨åè¦è¯»å–a.txtæ–‡ä»¶ä¸­çš„æ•°æ®å‘ç»™ä½ )ï¼Œè¿™ä¸¤éƒ¨åˆ†å…ˆå‘é€ç»™å®¢æˆ·ç«¯ï¼Œç„¶åå†åŠ è½½ç£ç›˜æ–‡ä»¶(sendfileæ¨¡å¼åŠ è½½)ï¼Œæ¯æŒ¤æ»¡ä¸€æ¬¡send bufferå°±å‘é€ä¸€æ¬¡ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®éƒ½å‘é€å®Œã€‚</p><h2 id=14-zero-copysplice>1.4 zero-copy:splice()</h2><p>manæ–‡æ¡£å¯¹æ­¤å‡½æ•°çš„æè¿°ï¼š</p><p>splice() moves data between two file descriptors without copying between kernel address space and user address space.<br>It transfers up to len bytes of data from the file descriptor fd_in to the file descriptor fd_out, where one of<br>thedescriptors must refer to a pipe.</p><p>splice()å‡½æ•°å¯ä»¥åœ¨ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¹‹é—´<strong>ç§»åŠ¨</strong>æ•°æ®ï¼Œä¸”å…¶ä¸­ä¸€ä¸ªæè¿°ç¬¦å¿…é¡»æ˜¯ç®¡é“æè¿°ç¬¦ã€‚ç”±äºä¸éœ€è¦åœ¨kernel bufferå’Œapp bufferä¹‹é—´æ‹·è´æ•°æ®ï¼Œæ‰€ä»¥å®ç°äº†é›¶å¤åˆ¶ã€‚å¦‚å›¾ï¼š</p><p><img src=https://images2017.cnblogs.com/blog/733013/201709/733013-20170930141156778-425254258.png alt="zero copy: splice" title="zero copy: splice"></p><p>æ³¨ï¼šç”±äºå¿…é¡»æœ‰ä¸€æ–¹æ˜¯ç®¡é“æè¿°ç¬¦ï¼Œæ‰€ä»¥ä¸Šå›¾ä¸­ï¼Œå¦‚æœæ˜¯å‘é€ç»™socketæ–‡ä»¶æè¿°ç¬¦ï¼Œé‚£ä¹ˆæ˜¯æ²¡æœ‰storage&ndash;>kernel bufferçš„DMAæ“ä½œçš„ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><div><pre><code class=language- data-lang>1
2
3
4</code></pre></div><h2 id=15-zero-copy-tee>1.5 zero-copy: tee()</h2><p>manæ–‡æ¡£å¯¹æ­¤å‡½æ•°çš„æè¿°ï¼š</p><p>tee() duplicates up to len bytes of data from the pipe referred to by the file descriptor fd_in to the pipe<br>referred to by the file descriptor fd_out. It does not consume the data that is duplicated from fd_in;<br>therefore, that data can be copied by a subsequent splice(2).</p><p>tee()å‡½æ•°åœ¨ä¸¤ä¸ªç®¡é“æè¿°ç¬¦ä¹‹é—´å¤åˆ¶æ•°æ®ã€‚ç”±äºä»in_fdå¤åˆ¶ç»™å¦ä¸€ä¸ªç®¡é“out_fdæ—¶ï¼Œä¸è®¤ä¸ºæ•°æ®æ˜¯æ¥è‡ªäºin_fdçš„ï¼Œæ‰€ä»¥å¤åˆ¶æ•°æ®åï¼Œin_fdä»å¯ä½¿ç”¨splice()å‡½æ•°è¿›è¡Œæ•°æ®ç§»åŠ¨ã€‚ç”±äºæ²¡æœ‰ç»è¿‡ç”¨æˆ·ç©ºé—´ï¼Œæ‰€ä»¥å®ç°äº†é›¶å¤åˆ¶ã€‚å¦‚å›¾ï¼š</p><p><img src=https://images2017.cnblogs.com/blog/733013/201709/733013-20170930185217356-719469285.png alt></p><p>Linuxä¸‹çš„teeç¨‹åºå°±æ˜¯ä½¿ç”¨teeå‡½æ•°ç»“åˆspliceå‡½æ•°å®ç°çš„ï¼Œå…ˆå°†æ•°æ®é€šè¿‡tee()å‡½æ•°æ‹·è´ç»™ç®¡é“ï¼Œå†ä½¿ç”¨splice()å‡½æ•°å°†æ•°æ®ç§»åŠ¨ç»™å¦ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><div><pre><code class=language- data-lang>1
2
3</code></pre></div><h2 id=16-å†™æ—¶å¤åˆ¶æŠ€æœ¯copy-on-writecow>1.6 å†™æ—¶å¤åˆ¶æŠ€æœ¯(copy-on-write,COW)</h2><p>å½“çˆ¶è¿›ç¨‹forkç”Ÿæˆå­è¿›ç¨‹æ—¶ï¼Œä¼šå¤åˆ¶å®ƒçš„æ‰€æœ‰å†…å­˜é¡µã€‚è¿™è‡³å°‘ä¼šå¯¼è‡´ä¸¤ä¸ªé—®é¢˜ï¼šæ¶ˆè€—å¤§é‡å†…å­˜ï¼›å¤åˆ¶æ“ä½œæ¶ˆè€—æ—¶é—´ã€‚ç‰¹åˆ«æ˜¯forkåä½¿ç”¨execåŠ è½½æ–°ç¨‹åºæ—¶ï¼Œç”±äºä¼šåˆå§‹åŒ–å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥å¤åˆ¶æ“ä½œå‡ ä¹æ˜¯å¤šä½™çš„ã€‚</p><p>ä½¿ç”¨copy-on-writeæŠ€æœ¯ï¼Œä½¿å¾—åœ¨forkå­è¿›ç¨‹æ—¶ä¸å¤åˆ¶å†…å­˜é¡µï¼Œè€Œæ˜¯å…±äº«å†…å­˜é¡µ(ä¹Ÿå°±æ˜¯è¯´ï¼Œå­è¿›ç¨‹ä¹ŸæŒ‡å‘çˆ¶è¿›ç¨‹çš„ç‰©ç†ç©ºé—´)ï¼Œåªæœ‰åœ¨è¯¥å­è¿›ç¨‹éœ€è¦ä¿®æ”¹æŸä¸€å—æ•°æ®ï¼Œæ‰ä¼šå°†è¿™ä¸€å—æ•°æ®æ‹·è´åˆ°è‡ªå·±çš„app bufferä¸­å¹¶è¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆè¿™ä¸€å—æ•°æ®å°±å±äºè¯¥å­è¿›ç¨‹çš„ç§æœ‰æ•°æ®ï¼Œå¯éšæ„è®¿é—®ã€ä¿®æ”¹ã€å¤åˆ¶ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå®ç°äº†é›¶å¤åˆ¶ï¼Œå³ä½¿å¤åˆ¶äº†ä¸€äº›æ•°æ®å—ï¼Œä¹Ÿæ˜¯åœ¨é€æ¸éœ€è¦çš„è¿‡ç¨‹è¿›è¡Œå¤åˆ¶çš„ã€‚</p><p>å†™æ—¶å¤åˆ¶å†…å®¹å¤ªå¤šï¼Œç®€å•æ¦‚è¿°çš„è¯å¤§æ¦‚å°±æ˜¯ä¸Šé¢æ‰€è¿°å†…å®¹ã€‚</p></section><div class=reward-container><button class=reward-button aria-expanded=false aria-controls=reward-pop>
æ”¯æŒä½œè€…</button><div id=reward-pop class="reward-popup hidden"><p class=reward-text>æ„Ÿè°¢æ”¯æŒï¼ğŸ»</p><div class=qr-container><div class=reward-qr><img src=/images/payment/wechat.jpg alt=å¾®ä¿¡æ”¯ä»˜äºŒç»´ç  loading=lazy><p>å¾®ä¿¡</p></div><div class=reward-qr><img src=/images/payment/alipay.jpg alt=æ”¯ä»˜å®äºŒç»´ç  loading=lazy><p>æ”¯ä»˜å®</p></div></div></div></div><style>.reward-container{text-align:center;margin:2rem 0}.reward-button{padding:.5rem 1.25rem;background-color:#f44336;color:#fff;border:none;border-radius:1rem;cursor:pointer;transition:all .2s ease;font-size:1rem}.reward-button:hover{background-color:red;font-size:1rem;transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,.2)}.reward-button:active{background-color:red;font-weight:700;font-size:.9rem;transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,.2)}.reward-popup{margin-top:1.5rem;opacity:0;transform:translateY(-10px);transition:all .3s ease}.reward-popup.visible{opacity:1;transform:translateY(0)}.reward-text{margin-bottom:1rem;color:#333;font-size:1.1rem}.reward-text:is(.dark *){margin-bottom:1rem;color:#fff;font-size:1.1rem}.qr-container{display:flex;justify-content:center;gap:2rem;flex-wrap:wrap}.reward-qr{text-align:center}.reward-qr img{width:200px;padding:1rem;background-color:#fff;border-radius:.5rem;box-shadow:0 2px 8px rgba(0,0,0,.1);transition:transform .2s ease}.reward-qr img:hover{transform:scale(1.02)}.reward-qr p{margin:.5rem 0 0;color:#666;font-size:.95rem}.reward-qr p:is(.dark *){margin:.5rem 0 0;color:#fff;font-size:.95rem}.hidden{display:none}</style><script>const button=document.querySelector(".reward-button"),popup=document.getElementById("reward-pop");button.addEventListener("click",()=>{const e=button.getAttribute("aria-expanded")==="true";button.setAttribute("aria-expanded",!e),popup.classList.toggle("hidden"),setTimeout(()=>{popup.classList.toggle("visible")},10)})</script><nav class="mt-24 flex overflow-hidden rounded-xl bg-black/[3%] text-lg !leading-[1.2] *:flex *:w-1/2 *:items-center *:p-5 *:font-medium *:no-underline dark:bg-white/[8%] [&>*:hover]:bg-black/[2%] dark:[&>*:hover]:bg-white/[3%]"><a class="ltr:pr-3 rtl:pl-3" href=https://simons.qzz.io/post/2026/01/c10k/><span class="ltr:mr-1.5 rtl:ml-1.5">â†</span><span>C10k é—®é¢˜</span></a>
<a class="ltr:ml-auto rtl:mr-auto justify-end pl-3" href=https://simons.qzz.io/post/2026/01/http_protcal/><span>Http åè®®</span><span class="ltr:ml-1.5 rtl:mr-1.5">â†’</span></a></nav><div class="mt-12 rounded-xl" style=text-align:center><button class=feedback-trigger onclick=toggleFeedback()>å»ºè®® / åé¦ˆ</button><div class="feedback-form hidden"><p>æ„Ÿè°¢ä½ çš„æè®®ï¼Œæˆ‘å°†ä¼šå°½å¿«ä½¿ç”¨å›å¤æ‚¨ï¼ï¼ˆæ­¤åé¦ˆå°†ä½¿ç”¨æ‚¨çš„é‚®ç®±å‘é€ï¼‰</p><form id=feedback-form onsubmit=sendFeedback(event)><input type=text name=name placeholder=æ€ä¹ˆç§°å‘¼ï¼Ÿ required>
<textarea name=message placeholder=è¯·è¾“å…¥æ‚¨çš„å»ºè®®æˆ–æ„è§... required></textarea>
<button type=submit>å‘é€</button></form></div><style>.feedback-trigger{background:#007bff;color:#fff;border:none;padding:.25rem .5rem;border-radius:12px;cursor:pointer;box-shadow:0 2px 5px rgba(0,0,0,.2);margin:1rem}.feedback-form{background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.1);margin-bottom:10px}.feedback-form.hidden{display:none}.feedback-form input,.feedback-form textarea{width:100%;margin-bottom:10px;padding:8px;border:1px solid #ddd;border-radius:4px}.feedback-form textarea{height:100px;resize:vertical}.feedback-form button{width:100%;background:#007bff;color:#fff;border:none;padding:8px;border-radius:4px;cursor:pointer}</style><script>function toggleFeedback(){document.querySelector(".feedback-form").classList.toggle("hidden")}function sendFeedback(e){e.preventDefault();const t=e.target,n=`mailto:reggiesimons2cy@gmail.com?subject=https://simons.qzz.io/ Feedback from ${t.name.value}&body=${encodeURIComponent(t.message.value)}%0D%0A%0D%0AFrom: ${t.name.value}%0D%0AEmail: ${t.email.value}`;window.location.href=n}</script></div><div class="mt-24 w-100rem" id=disqus_thread></div><script>const disqusShortname="caoyang2002.vercel.app",script=document.createElement("script");script.src="https://"+disqusShortname+".disqus.com/embed.js",script.setAttribute("data-timestamp",+new Date),document.head.appendChild(script)</script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.css><script src=https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js></script><div class="giscus mt-24"></div><script src=https://giscus.app/client.js data-repo=caoyang2002/caoyang2002 data-repo-id=R_kgDONgnnzg data-category=Announcements data-category-id=DIC_kwDONgnnzs4ClayH data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></article></main><div class="ml-2 mr-4"><button class=mobile-toc-toggle>
<svg t="1737363365612" class="icon" viewBox="0 0 1024 1024" p-id="7154" width="32" height="32"><path d="M811.6 264.1H378.2c-19.8.0-36-16.2-36-36s16.2-36 36-36h433.5c19.8.0 36 16.2 36 36-.1 19.8-16.3 36-36.1 36zm0 258H378.2c-19.8.0-36-16.2-36-36s16.2-36 36-36h433.5c19.8.0 36 16.2 36 36-.1 19.8-16.3 36-36.1 36zm0 258H378.2c-19.8.0-36-16.2-36-36s16.2-36 36-36h433.5c19.8.0 36 16.2 36 36-.1 19.8-16.3 36-36.1 36z" fill="#223D60" p-id="7155"/><path d="M210.2 229m-37.9.0a37.9 37.9.0 1075.8.0 37.9 37.9.0 10-75.8.0z" fill="#223D60" p-id="7156"/><path d="M210.2 487m-37.9.0a37.9 37.9.0 1075.8.0 37.9 37.9.0 10-75.8.0z" fill="#223D60" p-id="7157"/><path d="M210.2 745m-37.9.0a37.9 37.9.0 1075.8.0 37.9 37.9.0 10-75.8.0z" fill="#223D60" p-id="7158"/></svg></button><aside class="toc-aside mr-4"><div class=toc-container><div class=toc-header><h3 class=toc-title>ç›®å½•</h3><button class=toc-close>
<svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 18 6M6 6l12 12"/></svg></button></div><nav id=TableOfContents class=toc><nav id=TableOfContents><ul><li><a href=#é›¶å¤åˆ¶zero-copyæŠ€æœ¯>é›¶å¤åˆ¶(zero copy)æŠ€æœ¯</a><ul><li><a href=#11-èƒŒæ™¯è¯´æ˜ç½‘ç»œæ•°æ®ä¼ è¾“çš„å…¨è¿‡ç¨‹>1.1 èƒŒæ™¯è¯´æ˜ï¼šç½‘ç»œæ•°æ®ä¼ è¾“çš„å…¨è¿‡ç¨‹</a></li><li><a href=#12-zero-copymmap>1.2 zero-copy:mmap()</a></li><li><a href=#13-zero-copysendfile>1.3 zero-copy:sendfile()</a></li><li><a href=#14-zero-copysplice>1.4 zero-copy:splice()</a></li><li><a href=#15-zero-copy-tee>1.5 zero-copy: tee()</a></li><li><a href=#16-å†™æ—¶å¤åˆ¶æŠ€æœ¯copy-on-writecow>1.6 å†™æ—¶å¤åˆ¶æŠ€æœ¯(copy-on-write,COW)</a></li></ul></li></ul></nav></nav></div></aside><style>.toc-aside{position:fixed;top:6rem;bottom:4rem;right:0;width:16rem;z-index:100;transition:transform .3s ease}.toc-container{background:#fff;height:100%;border-radius:.5rem .5rem .5rem .5rem;box-shadow:-2px 0 8px rgba(0,0,0,.1);display:flex;flex-direction:column}.toc-header{position:sticky;border-radius:.5rem .5rem 0 0;top:0;background:#fff;padding:1rem;border-bottom:1px solid #e5e7eb;display:flex;justify-content:space-between;align-items:center;z-index:10}.toc-title{margin:0;font-size:1rem;font-weight:600}.mobile-toc-toggle{display:none;position:fixed;top:6rem;right:1rem;z-index:99;width:3rem;height:3rem;border-radius:50%;background:#fff;border:1px solid #e5e7eb;box-shadow:0 2px 8px rgba(0,0,0,.1);color:#4b5563;cursor:pointer;transition:all .2s}.mobile-toc-toggle:hover{background:#f3f4f6}.mobile-toc-toggle .menu-icon{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.toc-close{padding:.5rem;background:0 0;border:none;color:--bg;cursor:pointer;transition:all .2s}.toc-close:hover{color:#111827}.toc{flex:1;overflow-y:auto;padding:1rem;scrollbar-gutter:stable}.toc ul{list-style:none;padding-left:1rem;margin:0}.toc li{margin:.5rem 0}.toc a{display:block;padding:.25rem .5rem;color:#4b5563;text-decoration:none;border-radius:.25rem;transition:all .2s}.toc a:hover{background-color:#f3f4f6;color:#111827}.toc a:active{background-color:#f3f4f6;color:#111827;font-weight:500}.toc::-webkit-scrollbar{width:4px}.toc::-webkit-scrollbar-track{background:0 0}.toc::-webkit-scrollbar-thumb{background-color:#d1d1d1;border-radius:4px}@media(max-width:912px){.mobile-toc-toggle{display:flex;justify-content:center;align-items:center}.toc-aside{transform:translateX(100%);width:80vw;max-width:20rem}.toc-aside.show{transform:translateX(0)}}h1,h2,h3,h4,h5,h6{scroll-margin-top:100px}</style><script>document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".toc-aside"),t=document.querySelector(".mobile-toc-toggle"),n=document.querySelector(".toc-close");t?.addEventListener("click",()=>{e?.classList.add("show")}),n?.addEventListener("click",()=>{e?.classList.remove("show")}),document.addEventListener("click",n=>{window.innerWidth<=912&&e?.classList.contains("show")&&!e.contains(n.target)&&!t?.contains(n.target)&&e.classList.remove("show")});const s=new IntersectionObserver(e=>{e.forEach(e=>{const t=e.target.getAttribute("id"),n=document.querySelector(`.toc a[href="#${t}"]`);e.intersectionRatio>0&&(document.querySelectorAll(".toc a.active").forEach(e=>{e.classList.remove("active")}),n?.classList.add("active"))})},{rootMargin:"-20% 0px -80% 0px"});document.querySelectorAll("h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]").forEach(e=>{s.observe(e)})})</script></div></div><footer class="flex items-center text-xs uppercase h-8"><div class="mr-auto opacity-60">&copy; 2026
<a class=link href=https://simons.qzz.io/>çŸ­æ¾æ±Ÿæœˆ</a></div><div><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><p class="link mx-6 opacity-60">æœ¬ç«™ç´¯è®¡è®¿é—®æ¬¡æ•°
<span id=busuanzi_value_page_pv><i class="fa fa-spinner fa-spin"></i></span></p></div><a class="link mx-6 opacity-60" href=https://gohugo.io/ rel=noopener target=_blank>powered by hugoï¸ï¸</a>ï¸
<a class="link mx-6 opacity-60" href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>hugo-paper</a>
<a class="link opacity-60" href=https://github.com/caoyang2002/hugo-focus rel=noopener target=_blank>hugo-focus</a></footer><style>footer{position:fixed;bottom:0;left:0;right:0;z-index:50;width:100%;padding:.5rem;padding-bottom:calc(.5rem + var(--safe-padding-bottom));padding-left:max(.5rem,var(--safe-padding-left));padding-right:max(.5rem,var(--safe-padding-right));display:flex;justify-content:center;align-items:center;backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(12px);background:rgba(255,255,255,.85);border-top:1px solid rgba(255,255,255,.3);box-shadow:0 -4px 20px rgba(0,0,0,5%)}.dark footer{background:rgba(0,0,0,.85);border-top-color:rgba(255,255,255,.1)}.footer-content{width:100%;max-width:var(--w);margin:0 auto;padding:0 1rem;display:flex;flex-direction:row;align-items:center;justify-content:space-between;gap:1rem}.footer-element{padding:.75rem 1.5rem;font-size:.75rem;text-transform:uppercase;letter-spacing:.05em;opacity:.8;border-radius:.5rem;background:rgba(255,255,255,.1);backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px);transition:all .2s ease}.footer-element:hover{opacity:1;background:rgba(255,255,255,.2)}.dark .footer-element{background:rgba(255,255,255,5%)}.dark .footer-element:hover{background:rgba(255,255,255,.1)}@media(max-width:768px){footer{padding-top:.5rem;padding-bottom:calc(.5rem + env(safe-area-inset-bottom))}.footer-content{padding:0 .5rem;gap:.5rem}.footer-element{padding:.5rem 1rem;font-size:.75rem}}@media(min-width:768px){.footer-element{font-size:.875rem}}@media(min-width:1024px){.footer-content{padding:0 2rem;gap:2rem}.footer-element{padding:.75rem 2rem}}</style></body></html>